# リリース手順

## 通常のリリース

### 1. bumpコマンドを実行

```bash
pnpm bump 0.2.4  # 新しいバージョン番号を指定
```

このコマンド1つで以下がすべて自動実行されます：

- `apps/desktop/package.json` のバージョン更新
- `apps/www/src/constants/release.ts` の更新（LPのダウンロードリンクも連動）
- コミット作成（`chore: release v0.2.4`）
- タグ作成（`v0.2.4`）
- リモートへプッシュ

### 2. GitHub Actions が自動でビルド＆リリース

タグがプッシュされると、以下が自動実行されます：

- macOS (arm64/x64) と Windows のビルド
- このリポジトリにドラフトリリースを作成
- `surasura-releases` リポジトリにもリリースを自動作成
- `latest-mac.yml` / `latest.yml`（自動アップデート用）も自動生成

### 3. リリースノートを編集して公開

1. [Releases](https://github.com/tkcel/surasura/releases) ページでドラフトリリースを確認
2. リリースノートを編集
3. 「Publish release」をクリック

---

## 初回セットアップ（管理者のみ）

`surasura-releases` リポジトリへの自動アップロードには、GitHub Secrets の設定が必要です。

### RELEASE_REPO_TOKEN の作成

1. GitHub にログイン
2. 右上のプロフィールアイコン → **Settings**
3. 左サイドバーの一番下 → **Developer settings**
4. **Personal access tokens** → **Fine-grained tokens**
5. **Generate new token** をクリック

### トークンの設定

| 項目 | 設定値 |
|------|--------|
| **Token name** | `surasura-release-workflow`（任意の名前） |
| **Expiration** | 90 days や 1 year など（期限切れに注意） |
| **Resource owner** | `tkcel`（組織の場合は組織名） |
| **Repository access** | **Only select repositories** を選択 |
| **Select repositories** | `surasura-releases` を選択 |

### Permissions の設定

**Repository permissions** セクションで：

| Permission | Access level |
|------------|--------------|
| **Contents** | **Read and write** |

他はデフォルト（No access）のままでOKです。

### トークンを生成

1. **Generate token** をクリック
2. 表示されたトークンをコピー（この画面を閉じると二度と表示されません）

### GitHub Secrets に追加

1. [surasura リポジトリの Settings](https://github.com/tkcel/surasura/settings) を開く
2. 左サイドバー → **Secrets and variables** → **Actions**
3. **New repository secret** をクリック
4. 以下を入力：
   - **Name**: `RELEASE_REPO_TOKEN`
   - **Secret**: コピーしたトークン
5. **Add secret** をクリック

これで設定完了です。
