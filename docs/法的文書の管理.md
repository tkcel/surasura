# 法的文書の管理

プライバシーポリシー・免責事項などの法的文書は `packages/legal` パッケージで一元管理しています。

## ディレクトリ構成

```
packages/legal/
├── content/
│   ├── privacy-policy.md      # プライバシーポリシー
│   ├── disclaimer.md          # 免責事項
│   ├── external-services.md   # 外部サービス一覧（付録）
│   └── config.json            # 設定ファイル
├── scripts/
│   └── build-content.ts       # ビルドスクリプト
├── src/
│   ├── index.ts               # エクスポート
│   └── content.generated.ts   # 自動生成（編集不可）
└── dist/                      # ビルド成果物
```

## 文言の編集方法

### 1. Markdownファイルを編集

`packages/legal/content/` 内の該当ファイルを編集します。

| ファイル | 内容 |
|---------|------|
| `privacy-policy.md` | プライバシーポリシー |
| `disclaimer.md` | 免責事項 |
| `external-services.md` | 外部サービス一覧 |

### 2. ビルドを実行

```bash
cd packages/legal
pnpm build
```

これにより `src/content.generated.ts` が再生成され、`dist/` にビルド成果物が出力されます。

### 3. 各アプリで確認

- **デスクトップアプリ**: 設定 → このアプリについて → 法的情報
- **LP**: フッターのリンク、または `/privacy`, `/disclaimer`, `/external-services`

## 設定ファイル（config.json）

プレースホルダーの値を管理しています。

```json
{
  "lastUpdated": "2026-02-03",
  "contactInfo": "[X: @tkcel9](https://x.com/tkcel9) / [Discord](https://discord.gg/ffpmWv5d)",
  "appName": "surasura"
}
```

| キー | 用途 | Markdownでの記法 |
|-----|------|-----------------|
| `lastUpdated` | 最終更新日 | `{{LAST_UPDATED}}` |
| `contactInfo` | 連絡先（Markdown形式可） | `{{CONTACT_INFO}}` |
| `appName` | アプリ名 | `{{APP_NAME}}` |

## プレースホルダーの使い方

Markdownファイル内で `{{プレースホルダー名}}` と記述すると、ビルド時に `config.json` の値に置換されます。

```markdown
最終更新日: {{LAST_UPDATED}}

お問い合わせ: {{CONTACT_INFO}}
```

## 外部サービスの追加・変更

新しい外部サービスを追加する場合は、`external-services.md` のテーブルに行を追加します。

```markdown
| サービス名 | 提供元 | 用途 | プライバシーポリシー |
|-----------|--------|------|---------------------|
| Whisper API | OpenAI | 音声認識 | [OpenAI Privacy Policy](https://openai.com/policies/privacy-policy) |
| 新サービス | 提供元 | 用途 | [リンク](URL) |
```

## 利用側（アプリ）での使い方

### インポート

```typescript
import {
  getPrivacyPolicy,
  getDisclaimer,
  getExternalServices,
  getLegalDocument,
  type LegalDocument,
  type LegalDocumentType,
} from "@surasura/legal";
```

### 関数

| 関数 | 戻り値 | 説明 |
|-----|-------|------|
| `getPrivacyPolicy()` | `LegalDocument` | プライバシーポリシーを取得 |
| `getDisclaimer()` | `LegalDocument` | 免責事項を取得 |
| `getExternalServices()` | `LegalDocument` | 外部サービス一覧を取得 |
| `getLegalDocument(type)` | `LegalDocument` | 指定タイプのドキュメントを取得 |
| `getAllLegalDocuments()` | `LegalDocument[]` | 全ドキュメントを取得 |
| `getLegalConfig()` | `LegalConfig` | 設定情報を取得 |

### LegalDocument 型

```typescript
interface LegalDocument {
  id: LegalDocumentType;  // "privacy-policy" | "disclaimer" | "external-services"
  title: string;          // Markdownの最初の # から抽出
  content: string;        // プレースホルダー置換済みのMarkdown
}
```

## 注意事項

- `src/content.generated.ts` は自動生成ファイルのため、直接編集しないでください
- 文言を変更したら必ず `pnpm build` を実行してください
- 各アプリは `@surasura/legal` パッケージを依存関係として持っているため、パッケージのビルド後にアプリを再起動すると変更が反映されます
