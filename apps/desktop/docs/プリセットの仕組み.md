# プリセットの仕組み

音声入力したテキストがどのように整形されるのか、その仕組みをわかりやすく説明します。

---

## AIへの指示の仕組み

surasuraでは、音声認識された文章をAI（GPT）が整形します。このとき、AIには2種類の指示が送られます。

### システムプロンプトとは

**システムプロンプト**は、AIの「役割」や「ルール」を定義する指示です。

人間に例えると、新しい仕事を始めるときに渡される**マニュアル**や**業務ルール**のようなものです。

```
例：
「あなたはテキスト整形アシスタントです。
 句読点を適切に配置し、フィラーを除去してください。
 入力にない内容を追加しないでください。」
```

### ユーザープロンプトとは

**ユーザープロンプト**は、AIに処理してほしい**具体的な内容**です。

人間に例えると、マニュアルを渡された後に「**これをお願いします**」と渡される**実際の仕事**のようなものです。

```
例：
「えー本日はですねあのー会議の議題についてご説明します」
```

### 2つの組み合わせ

AIは、システムプロンプト（ルール）に従って、ユーザープロンプト（実際の文章）を処理します。

```
┌─────────────────────────────────────┐
│ システムプロンプト（ルール）        │
│ 「句読点を付けて、フィラーを除去」  │
└─────────────────────────────────────┘
            ↓ このルールに従って
┌─────────────────────────────────────┐
│ ユーザープロンプト（処理対象）      │
│ 「えー本日はですねあのー会議の...」 │
└─────────────────────────────────────┘
            ↓ 処理すると
┌─────────────────────────────────────┐
│ 結果                                │
│ 「本日は、会議の議題について...」   │
└─────────────────────────────────────┘
```

---

## プリセットとは

**プリセット**は、システムプロンプトの内容を自分好みにカスタマイズできる機能です。

料理に例えると、レシピのようなものです。同じ材料（音声認識結果）でも、レシピ（プリセット）を変えると、違う料理（整形結果）ができあがります。

### デフォルトプリセット

| プリセット名 | 用途 |
|-------------|------|
| **標準** | 話し言葉を自然な書き言葉に変換します |
| **カジュアル** | ビジネスでも使える、親しみやすい文体にします |
| **即時回答** | 質問として解釈し、回答を生成します |

---

## 変数機能

プリセットの指示文の中で、**変数**を使うことができます。変数は `{{変数名}}` の形式で書きます。

### 使える変数

| 変数 | 説明 | 入る内容の例 |
|------|------|-------------|
| `{{transcription}}` | 音声認識結果 | 「今日の会議について説明します」 |
| `{{selectedText}}` | 選択中のテキスト | （入力欄で選択していたテキスト） |
| `{{appName}}` | 使用中のアプリ名 | 「Slack」「Notion」など |

### 変数の使い方

変数は、音声入力した瞬間に**実際の値に置き換わります**。

**例：プリセットの指示文**
```
「{{transcription}}」を、{{appName}}で使いやすい文体に整形してください。
```

**音声入力時（Slackを使用中）**
```
「今日の会議について説明します」を、Slackで使いやすい文体に整形してください。
```

### 活用例

#### 例1：選択テキストを参考にする

```
以下の参考テキストの文体に合わせて「{{transcription}}」を整形してください。

【参考テキスト】
{{selectedText}}
```

→ 入力欄で文章を選択した状態で音声入力すると、その文章の文体に合わせて整形されます。

#### 例2：アプリごとに整形を変える

```
「{{transcription}}」を整形してください。

現在のアプリ: {{appName}}

- Slackの場合：カジュアルに
- メールアプリの場合：丁寧に
- その他：標準的に
```

→ 使用中のアプリに応じて、AIが適切な文体を選んでくれます。

---

## 処理の流れ

音声入力から整形完了までの流れを図で示します。

```
┌──────────────┐
│ 1. 音声入力   │  あなたが話す
└──────┬───────┘
       ↓
┌──────────────┐
│ 2. 音声認識   │  Whisper APIが文字に変換
└──────┬───────┘      「えー今日はですねあのー...」
       ↓
┌──────────────┐
│ 3. 変数の置換 │  {{transcription}} → 実際のテキスト
└──────┬───────┘  {{appName}} → 「Slack」
       ↓
┌──────────────┐
│ 4. AI整形     │  GPTがルールに従って整形
└──────┬───────┘
       ↓
┌──────────────┐
│ 5. 貼り付け   │  整形されたテキストが入力される
└──────────────┘      「本日は、〇〇について...」
```

---

## よくある質問

### Q: 変数を使わないとどうなりますか？

変数を使わなくても、音声認識結果は自動的にAIに送られて整形されます。変数は、より細かくカスタマイズしたい場合に使う機能です。

### Q: `{{transcription}}` は必ず使う必要がありますか？

いいえ、必須ではありません。使わない場合でも、音声認識結果はAIに送られます。

`{{transcription}}` を使うと、指示文の中で音声認識結果を明示的に参照できます。例えば「〇〇を△△してください」という形式で指示を書けます。

### Q: 選択テキストがない場合、`{{selectedText}}` はどうなりますか？

空文字（何もない状態）に置き換わります。プリセットを作る際は、選択テキストがない場合も考慮した指示文を書くことをおすすめします。

### Q: プリセットは何個まで作れますか？

最大5個まで作成できます。

---

## 関連ドキュメント

より技術的な詳細を知りたい方は、以下のドキュメントをご覧ください。

- [プロンプト呼び出しタイミング](./プロンプト呼び出しタイミング.md) - エンジニア向けの詳細な仕様書
